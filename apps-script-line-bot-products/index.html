<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/hexo%2Fstella-coding-logo-black-word-removebg.png?alt=media&token=c666151f-86ea-4033-abc1-d06be5041e2b">
  <link rel="icon" type="image/png" sizes="32x32" href="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/hexo%2Fstella-coding-logo-black-word-removebg.png?alt=media&token=c666151f-86ea-4033-abc1-d06be5041e2b">
  <link rel="icon" type="image/png" sizes="16x16" href="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/hexo%2Fstella-coding-logo-black-word-removebg.png?alt=media&token=c666151f-86ea-4033-abc1-d06be5041e2b">
  <link rel="mask-icon" href="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/hexo%2Fstella-coding-logo-black-word-removebg.png?alt=media&token=c666151f-86ea-4033-abc1-d06be5041e2b" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"estellacoding.github.io","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/blog/js/config.js"></script>

    <meta name="description" content="é€šå¸¸åœ¨é–‹ç™¼ LINE Bot çš„æ™‚å€™ï¼Œæƒ³è¦æ­£å¼ä¸Šç·šçµ¦ä½¿ç”¨è€…ä½¿ç”¨ï¼Œå› ç‚ºè¦ä¿æŒ Webhook é€£ç·šï¼Œå°±å¿…é ˆç”³è«‹ä¸€å°é›²ç«¯ä¸»æ©Ÿï¼Œä½†é€šå¸¸éƒ½éœ€è¦æ”¯ä»˜è²»ç”¨ã€‚ä½†æˆ‘ç™¼ç¾å…¶å¯¦å¯ä»¥ç”¨ Google Apps Script (GAS) ä¾†é–‹ç™¼ï¼ŒGAS æ”¯æ´ HTTPS Webhookã€æ’ç¨‹è§¸ç™¼å™¨ï¼Œé‡é»æœ‰å…è²»é¡åº¦ï¼Œä¸å¿…é¡å¤–èŠ±éŒ¢ï¼Œä¹Ÿçœä¸‹äº†ä¼ºæœå™¨ç¶­è­·çš„è² æ“”ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ç”¨ Apps Script å»ºç«‹ LINE Bot æŸ¥è©¢è³‡æ–™å°å¹«æ‰‹">
<meta property="og:url" content="https://estellacoding.github.io/blog/apps-script-line-bot-products/index.html">
<meta property="og:site_name" content="å²æˆ´æ‹‰å¯«æ‰£">
<meta property="og:description" content="é€šå¸¸åœ¨é–‹ç™¼ LINE Bot çš„æ™‚å€™ï¼Œæƒ³è¦æ­£å¼ä¸Šç·šçµ¦ä½¿ç”¨è€…ä½¿ç”¨ï¼Œå› ç‚ºè¦ä¿æŒ Webhook é€£ç·šï¼Œå°±å¿…é ˆç”³è«‹ä¸€å°é›²ç«¯ä¸»æ©Ÿï¼Œä½†é€šå¸¸éƒ½éœ€è¦æ”¯ä»˜è²»ç”¨ã€‚ä½†æˆ‘ç™¼ç¾å…¶å¯¦å¯ä»¥ç”¨ Google Apps Script (GAS) ä¾†é–‹ç™¼ï¼ŒGAS æ”¯æ´ HTTPS Webhookã€æ’ç¨‹è§¸ç™¼å™¨ï¼Œé‡é»æœ‰å…è²»é¡åº¦ï¼Œä¸å¿…é¡å¤–èŠ±éŒ¢ï¼Œä¹Ÿçœä¸‹äº†ä¼ºæœå™¨ç¶­è­·çš„è² æ“”ã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2FreplyTextMessage.jpg?alt=media&amp;token=edb7ab50-fb3d-4941-8ad9-31b594d5fd66">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2FreplyFlexMessage.jpg?alt=media&amp;token=d726aa46-a7ad-42ef-8d5c-45b3ad476434">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2FaddRecord.jpg?alt=media&amp;token=35bf9de3-b8db-49bc-a593-1a910a24468d">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2Fproducts-data.jpg?alt=media&amp;token=e1e09ce3-4eb8-4239-9b35-cf4d94f1d2d8">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2Flog.jpg?alt=media&amp;token=0ac60c93-a09e-4368-a2e1-12bef24af55a">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2Ftriggers-total-runtime.jpg?alt=media&amp;token=536d6319-c86e-416b-af0a-f305236fa1e5">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2Furl-fetch-calls.jpg?alt=media&amp;token=78b5a0da-26d5-40b0-9f4e-ec7ed130506b">
<meta property="article:published_time" content="2025-04-30T03:11:11.000Z">
<meta property="article:modified_time" content="2025-04-30T03:11:11.000Z">
<meta property="article:author" content="å²æˆ´æ‹‰">
<meta property="article:tag" content="Apps Script">
<meta property="article:tag" content="LINE Bot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2FreplyTextMessage.jpg?alt=media&amp;token=edb7ab50-fb3d-4941-8ad9-31b594d5fd66">


<link rel="canonical" href="https://estellacoding.github.io/blog/apps-script-line-bot-products/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://estellacoding.github.io/blog/apps-script-line-bot-products/","path":"apps-script-line-bot-products/","title":"ç”¨ Apps Script å»ºç«‹ LINE Bot æŸ¥è©¢è³‡æ–™å°å¹«æ‰‹"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ç”¨ Apps Script å»ºç«‹ LINE Bot æŸ¥è©¢è³‡æ–™å°å¹«æ‰‹ | å²æˆ´æ‹‰å¯«æ‰£</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EG0CKC3093"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-EG0CKC3093","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/blog/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">å²æˆ´æ‹‰å¯«æ‰£</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hands-on fuels my soul!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#LINE-token"><span class="nav-number">1.</span> <span class="nav-text">LINE token</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8"><span class="nav-number">2.</span> <span class="nav-text">è¨­å®šç’°å¢ƒè®Šæ•¸</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%A3%E5%91%8A%E5%85%A8%E5%9F%9F%E8%AE%8A%E6%95%B8"><span class="nav-number">3.</span> <span class="nav-text">å®£å‘Šå…¨åŸŸè®Šæ•¸</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9E%E8%A6%86LINE%E8%A8%8A%E6%81%AF"><span class="nav-number">4.</span> <span class="nav-text">å›è¦†LINEè¨Šæ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#replyTextMessage"><span class="nav-number">4.1.</span> <span class="nav-text">replyTextMessage</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#replyFlexMessage"><span class="nav-number">4.2.</span> <span class="nav-text">replyFlexMessage</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%95%9F%E7%94%A8%E5%B0%8F%E5%B9%AB%E6%89%8B"><span class="nav-number">5.</span> <span class="nav-text">å•Ÿç”¨å°å¹«æ‰‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#addRecord"><span class="nav-number">5.1.</span> <span class="nav-text">addRecord</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#removeRecord"><span class="nav-number">5.2.</span> <span class="nav-text">removeRecord</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%94%A2%E5%93%81%E9%8A%B7%E5%94%AE%E8%B3%87%E6%96%99"><span class="nav-number">6.</span> <span class="nav-text">ç”¢å“éŠ·å”®è³‡æ–™</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#getProductData"><span class="nav-number">6.1.</span> <span class="nav-text">getProductData</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#groupAndSortProducts"><span class="nav-number">6.2.</span> <span class="nav-text">groupAndSortProducts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B3%87%E6%96%99%E6%A0%BC%E5%BC%8F%E8%99%95%E7%90%86"><span class="nav-number">6.3.</span> <span class="nav-text">è³‡æ–™æ ¼å¼è™•ç†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#createFlexBubbles"><span class="nav-number">6.4.</span> <span class="nav-text">createFlexBubbles</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E8%A8%98%E9%8C%84"><span class="nav-number">7.</span> <span class="nav-text">æ“ä½œè¨˜éŒ„</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BB%E7%A8%8B%E5%BC%8F"><span class="nav-number">8.</span> <span class="nav-text">ä¸»ç¨‹å¼</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2"><span class="nav-number">9.</span> <span class="nav-text">éƒ¨ç½²</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%8D%E8%B2%BB%E9%85%8D%E9%A1%8D%E5%92%8C%E9%99%90%E5%88%B6"><span class="nav-number">10.</span> <span class="nav-text">å…è²»é…é¡å’Œé™åˆ¶</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E9%A1%8D%E4%BC%B0%E7%AE%97%E5%B0%8F%E5%B7%A5%E5%85%B7"><span class="nav-number">11.</span> <span class="nav-text">é…é¡ä¼°ç®—å°å·¥å…·</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%B8%E7%99%BC%E6%A2%9D%E4%BB%B6%E7%B8%BD%E5%9F%B7%E8%A1%8C%E9%9A%8E%E6%AE%B5"><span class="nav-number">11.1.</span> <span class="nav-text">è§¸ç™¼æ¢ä»¶ç¸½åŸ·è¡Œéšæ®µ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%B8%E7%99%BC%E5%99%A8%E6%AF%8F%E6%AC%A1%E5%9F%B7%E8%A1%8C%E6%99%82%E9%96%93"><span class="nav-number">11.1.1.</span> <span class="nav-text">è§¸ç™¼å™¨æ¯æ¬¡åŸ·è¡Œæ™‚é–“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%B8%E7%99%BC%E5%99%A8%E9%96%93%E9%9A%94%E6%99%82%E9%96%93"><span class="nav-number">11.1.2.</span> <span class="nav-text">è§¸ç™¼å™¨é–“éš”æ™‚é–“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B6%B2%E5%9D%80%E6%93%B7%E5%8F%96%E5%91%BC%E5%8F%AB%E6%AC%A1%E6%95%B8"><span class="nav-number">11.2.</span> <span class="nav-text">ç¶²å€æ“·å–å‘¼å«æ¬¡æ•¸</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E9%A1%8D%E4%BC%B0%E7%AE%97%E5%B0%8F%E5%B7%A5%E5%85%B7-v2"><span class="nav-number">11.3.</span> <span class="nav-text">é…é¡ä¼°ç®—å°å·¥å…·</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å²æˆ´æ‹‰"
      src="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/hexo%2Fstellacoding_logo_v1.png?alt=media&token=ae90d59c-5e7c-4d67-86a7-b87035725b96">
  <p class="site-author-name" itemprop="name">å²æˆ´æ‹‰</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">123</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/estellacoding" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;estellacoding" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://open.substack.com/pub/stellacoding" title="Substack â†’ https:&#x2F;&#x2F;open.substack.com&#x2F;pub&#x2F;stellacoding" rel="noopener me" target="_blank"><i class="fas fa-newspaper fa-fw"></i>Substack</a>
      </span>
  </div>

        </div>
      </div>
    </div>
    
    
      
      
    

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://estellacoding.github.io/blog/apps-script-line-bot-products/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/hexo%2Fstellacoding_logo_v1.png?alt=media&token=ae90d59c-5e7c-4d67-86a7-b87035725b96">
      <meta itemprop="name" content="å²æˆ´æ‹‰">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å²æˆ´æ‹‰å¯«æ‰£">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ç”¨ Apps Script å»ºç«‹ LINE Bot æŸ¥è©¢è³‡æ–™å°å¹«æ‰‹ | å²æˆ´æ‹‰å¯«æ‰£">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ç”¨ Apps Script å»ºç«‹ LINE Bot æŸ¥è©¢è³‡æ–™å°å¹«æ‰‹
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-30 11:11:11" itemprop="dateCreated datePublished" datetime="2025-04-30T11:11:11+08:00">2025-04-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Apps-Script/" itemprop="url" rel="index"><span itemprop="name">Apps Script</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Apps-Script/LINE-Bot/" itemprop="url" rel="index"><span itemprop="name">LINE Bot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>é€šå¸¸åœ¨é–‹ç™¼ LINE Bot çš„æ™‚å€™ï¼Œæƒ³è¦æ­£å¼ä¸Šç·šçµ¦ä½¿ç”¨è€…ä½¿ç”¨ï¼Œå› ç‚ºè¦ä¿æŒ Webhook é€£ç·šï¼Œå°±å¿…é ˆç”³è«‹ä¸€å°é›²ç«¯ä¸»æ©Ÿï¼Œä½†é€šå¸¸éƒ½éœ€è¦æ”¯ä»˜è²»ç”¨ã€‚ä½†æˆ‘ç™¼ç¾å…¶å¯¦å¯ä»¥ç”¨ Google Apps Script (GAS) ä¾†é–‹ç™¼ï¼ŒGAS æ”¯æ´ HTTPS Webhookã€æ’ç¨‹è§¸ç™¼å™¨ï¼Œé‡é»æœ‰å…è²»é¡åº¦ï¼Œä¸å¿…é¡å¤–èŠ±éŒ¢ï¼Œä¹Ÿçœä¸‹äº†ä¼ºæœå™¨ç¶­è­·çš„è² æ“”ã€‚</p>
<span id="more"></span>
<p>åœ¨é€™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°‡åˆ†äº«ç”¨ Google Apps Script (GAS) å»ºç«‹ LINE Bot æŸ¥è©¢è³‡æ–™å°å¹«æ‰‹ï¼Œå¯ä»¥å”åŠ©æŸ¥è©¢ç”¢å“éŠ·å”®æ•¸æ“šï¼Œä¸¦é€é LINE è¨Šæ¯è‡ªå‹•å›è¦†ä½¿ç”¨è€…æˆ–ç¾¤çµ„ã€‚</p>
<p>LINE Bot æŸ¥è©¢è³‡æ–™å°å¹«æ‰‹çš„åŠŸèƒ½æœ‰:</p>
<ul>
<li>è¨˜éŒ„ä½¿ç”¨è€…IDæ˜¯å¦å•Ÿç”¨å°å¹«æ‰‹</li>
<li>è¨˜éŒ„ç¾¤çµ„IDæ˜¯å¦å•Ÿç”¨å°å¹«æ‰‹</li>
<li>å–æ¶ˆå•Ÿç”¨å°å¹«æ‰‹åŠåˆªé™¤ç´€éŒ„</li>
<li>è®€å–ç”¢å“éŠ·å”®è³‡æ–™åŠæ’åº</li>
<li>ä»¥LINEæ–‡å­—æˆ–Flexè¨Šæ¯å›è¦†</li>
<li>è‡ªå‹•è¨˜éŒ„éŒ¯èª¤è³‡è¨Šä¾›Debugç”¨</li>
</ul>
<style>
.callout {
  border: 1px solid #eee;
  padding: 1em;
  background: #eef7fa;
  margin: 1em 0;
}
.callout-icon {
  font-size: 1.2em;
  margin-right: 8px;
}
.callout a {
  color: #0077cc;
  text-decoration: none;
}
.callout a:hover {
  text-decoration: underline;
}
</style>
<div class="callout">
<span class="callout-icon">ğŸ’¡</span>
æ­¡è¿åŠ å…¥æˆ‘çš„å®˜æ–¹ LINE å¸³è™Ÿ ğŸ‘‰ 
<a href="https://lin.ee/VPYVeGH" target="_blank">å²æˆ´æ‹‰å¯«æ‰£</a><br>
é»æ“Šåœ–æ–‡é¸å–®çš„ã€Œ<strong>å°å¹«æ‰‹</strong>ã€ï¼Œç„¶å¾Œè¼¸å…¥ä»¥ä¸‹é—œéµå­—å³å¯å•Ÿç”¨å°æ‡‰åŠŸèƒ½:<br>
- <strong>å•Ÿç”¨å°å¹«æ‰‹</strong>: å•Ÿç”¨å°å¹«æ‰‹<br>
- <strong>å–æ¶ˆå•Ÿç”¨å°å¹«æ‰‹</strong>: å–æ¶ˆå•Ÿç”¨å°å¹«æ‰‹<br>
- <strong>çµ±è¨ˆç”¢å“éŠ·å”®æ•¸æ“š</strong>: æŸ¥çœ‹Flexå¡ç‰‡è¨Šæ¯çµ±è¨ˆè³‡æ–™
</div>
<h1 id="LINE-token"><a class="header-anchor" href="#LINE-token"></a>LINE token</h1>
<ol>
<li>å»ºç«‹ <a target="_blank" rel="noopener" href="https://manager.line.biz/">LINE å®˜æ–¹å¸³è™Ÿ</a></li>
<li>LINE OA è¨­å®šå•Ÿç”¨ Messaging API åŠŸèƒ½</li>
<li>å‰å¾€ <a target="_blank" rel="noopener" href="https://developers.line.biz/console/">LINE Developers</a></li>
<li>é¸æ“‡ä¸€å€‹ LINE å®˜æ–¹å¸³è™Ÿ</li>
<li>é€²å…¥ã€ŒMessaging APIã€è¨­å®šé </li>
<li>å–å¾— <code>Channel access token</code></li>
</ol>
<h1 id="è¨­å®šç’°å¢ƒè®Šæ•¸"><a class="header-anchor" href="#è¨­å®šç’°å¢ƒè®Šæ•¸"></a>è¨­å®šç’°å¢ƒè®Šæ•¸</h1>
<p>æ–°å¢ Google Sheetï¼Œé€²å…¥ Apps Script ç·¨è¼¯å™¨çš„è¨­å®šï¼Œåœ¨ Script Properties ä¸­æ–°å¢ä»¥ä¸‹è®Šæ•¸ã€‚</p>
<ul>
<li>LINE_CHANNEL_TOKEN: ä½ çš„ LINE Channel access token</li>
<li>SHEET_ID: ä½ çš„ Google Sheet ID</li>
</ul>
<h1 id="å®£å‘Šå…¨åŸŸè®Šæ•¸"><a class="header-anchor" href="#å®£å‘Šå…¨åŸŸè®Šæ•¸"></a>å®£å‘Šå…¨åŸŸè®Šæ•¸</h1>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨åŸŸè®Šæ•¸å€</span></span><br><span class="line"><span class="keyword">const</span> LINE_CHANNEL_TOKEN = PropertiesService.getScriptProperties().getProperty(<span class="string">&#x27;LINE_CHANNEL_TOKEN&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> SHEET_ID = PropertiesService.getScriptProperties().getProperty(<span class="string">&#x27;SHEET_ID&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ACTIVATE_KEYWORD = <span class="string">&#x27;å•Ÿç”¨å°å¹«æ‰‹&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> DEACTIVATE_KEYWORD = <span class="string">&#x27;å–æ¶ˆå•Ÿç”¨å°å¹«æ‰‹&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> PRODUCTS_KEYWORD = <span class="string">&#x27;çµ±è¨ˆç”¢å“éŠ·å”®æ•¸æ“š&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h1 id="å›è¦†LINEè¨Šæ¯"><a class="header-anchor" href="#å›è¦†LINEè¨Šæ¯"></a>å›è¦†LINEè¨Šæ¯</h1>
<h2 id="replyTextMessage"><a class="header-anchor" href="#replyTextMessage"></a>replyTextMessage</h2>
<p>å‚³é€ä¸€èˆ¬ç´”æ–‡å­—ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// ç™¼é€<span class="type">LINE</span>æ–‡å­—è¨Šæ¯</span><br><span class="line"><span class="keyword">function</span> replyTextMessage(replyToken, <span class="type">text</span>) &#123;</span><br><span class="line">  const url = <span class="string">&#x27;https://api.line.me/v2/bot/message/reply&#x27;</span>;</span><br><span class="line">  const <span class="keyword">options</span> = &#123;</span><br><span class="line">    <span class="keyword">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">      <span class="keyword">Authorization</span>: <span class="string">&#x27;Bearer &#x27;</span> + LINE_CHANNEL_TOKEN</span><br><span class="line">    &#125;,</span><br><span class="line">    payload: <span class="type">JSON</span>.stringify(&#123;</span><br><span class="line">      replyToken: replyToken,</span><br><span class="line">      messages: [&#123; <span class="keyword">type</span>: <span class="string">&#x27;text&#x27;</span>, <span class="type">text</span>: <span class="type">text</span> &#125;]</span><br><span class="line">    &#125;),</span><br><span class="line">    muteHttpExceptions: <span class="keyword">true</span></span><br><span class="line">  &#125;;</span><br><span class="line">  const response = UrlFetchApp.<span class="keyword">fetch</span>(url, <span class="keyword">options</span>);</span><br><span class="line">  Logger.log(<span class="string">&#x27;å›è¦†è¨Šæ¯çš„response: &#x27;</span> + response.getContentText());</span><br><span class="line">  logError(<span class="string">&#x27;å›è¦†è¨Šæ¯çš„response: &#x27;</span> + response.getContentText());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2FreplyTextMessage.jpg?alt=media&amp;token=edb7ab50-fb3d-4941-8ad9-31b594d5fd66" alt="replyTextMessage"></p>
<h2 id="replyFlexMessage"><a class="header-anchor" href="#replyFlexMessage"></a>replyFlexMessage</h2>
<p>å‚³é€ Flex Message æ ¼å¼çš„åœ–æ–‡è¨Šæ¯ã€‚</p>
<div class="note info"><p>å¯ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developers.line.biz/flex-simulator/">FLEX MESSAGE SIMULATOR</a> è¨­è¨ˆFlexè¨Šæ¯çš„å…§å®¹ã€‚</p>
</div>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç™¼é€LINE Flexè¨Šæ¯</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replyFlexMessage</span>(<span class="params">replyToken, flexContents, altText</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">url</span> = <span class="string">&#x27;https://api.line.me/v2/bot/message/reply&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">payload</span> = JSON.<span class="title function_ invoke__">stringify</span>(&#123;</span><br><span class="line">    <span class="attr">replyToken</span>: replyToken,</span><br><span class="line">    <span class="attr">messages</span>: [&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;flex&#x27;</span>,</span><br><span class="line">      <span class="attr">altText</span>: altText,</span><br><span class="line">      <span class="attr">contents</span>: flexContents</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">response</span> = UrlFetchApp.<span class="title function_ invoke__">fetch</span>(url, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;Bearer &#x27;</span> + LINE_CHANNEL_TOKEN</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">payload</span>: payload,</span><br><span class="line">    <span class="attr">muteHttpExceptions</span>: <span class="literal">true</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  Logger.<span class="title function_ invoke__">log</span>(response.<span class="title function_ invoke__">getContentText</span>());</span><br><span class="line">  <span class="title function_ invoke__">logError</span>(<span class="string">&#x27;å›è¦†Flexè¨Šæ¯çš„response: &#x27;</span> + response.<span class="title function_ invoke__">getContentText</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2FreplyFlexMessage.jpg?alt=media&amp;token=d726aa46-a7ad-42ef-8d5c-45b3ad476434" alt="replyFlexMessage"></p>
<h1 id="å•Ÿç”¨å°å¹«æ‰‹"><a class="header-anchor" href="#å•Ÿç”¨å°å¹«æ‰‹"></a>å•Ÿç”¨å°å¹«æ‰‹</h1>
<h2 id="addRecord"><a class="header-anchor" href="#addRecord"></a>addRecord</h2>
<p>ç•¶ä½¿ç”¨è€…å‚³ä¾†ã€Œå•Ÿç”¨å°å¹«æ‰‹ã€è¨Šæ¯æ™‚:</p>
<ul>
<li>æª¢æŸ¥ line_ids è¡¨ä¸­æ˜¯å¦å·²æœ‰ç´€éŒ„</li>
<li>å¦‚æœæ²’æœ‰ï¼Œå°±æ–°å¢ä¸€ç­†ç´€éŒ„ï¼ˆåŒ…å«æ™‚é–“ã€ä¾†æºé¡å‹ã€ä½¿ç”¨è€…IDã€ç¾¤çµ„IDã€åŸå§‹è¨Šæ¯ï¼‰</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// åŠ å…¥ç´€éŒ„ï¼ˆç§è¨Šæˆ–ç¾¤çµ„ï¼‰</span><br><span class="line"><span class="keyword">function</span> addRecord(sourceType, groupId, userId, message) &#123;</span><br><span class="line">  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(<span class="string">&#x27;line_ids&#x27;</span>);</span><br><span class="line">  const <span class="keyword">rows</span> = sheet.getDataRange().getValues();</span><br><span class="line"></span><br><span class="line">  groupId = groupId || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  userId = userId || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  // æª¢æŸ¥æ˜¯å¦å·²ç¶“å­˜åœ¨</span><br><span class="line">  const <span class="keyword">exists</span> = <span class="keyword">rows</span>.<span class="keyword">some</span>(<span class="keyword">row</span> =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">row</span>[<span class="number">1</span>] === sourceType &amp;&amp;</span><br><span class="line">           <span class="keyword">row</span>[<span class="number">2</span>] === userId &amp;&amp;</span><br><span class="line">           <span class="keyword">row</span>[<span class="number">3</span>] === groupId;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">exists</span>) <span class="keyword">return</span> <span class="keyword">false</span>; // å¦‚æœå­˜åœ¨å°±ä¸æ–°å¢</span><br><span class="line"></span><br><span class="line">  // æ–°å¢ä¸€ç­†è¨˜éŒ„</span><br><span class="line">  const <span class="type">timestamp</span> = <span class="built_in">new</span> <span class="type">Date</span>();</span><br><span class="line">  sheet.appendRow([<span class="type">timestamp</span>, sourceType, userId, groupId, message]);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2FaddRecord.jpg?alt=media&amp;token=35bf9de3-b8db-49bc-a593-1a910a24468d" alt="addRecord"></p>
<h2 id="removeRecord"><a class="header-anchor" href="#removeRecord"></a>removeRecord</h2>
<p>ç•¶ä½¿ç”¨è€…å‚³ä¾†ã€Œå–æ¶ˆå•Ÿç”¨å°å¹«æ‰‹ã€è¨Šæ¯æ™‚:</p>
<ul>
<li>åœ¨ line_ids è¡¨æ ¼ä¸­æœå°‹ç¬¦åˆæ¢ä»¶çš„è³‡æ–™åˆ—</li>
<li>è‹¥æ‰¾åˆ°ï¼Œå°±åˆªé™¤è©²åˆ—ç´€éŒ„</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç§»é™¤ç´€éŒ„</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeRecord</span>(<span class="params">sourceType, groupId, userId</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> sheet = <span class="title class_">SpreadsheetApp</span>.<span class="title function_">openById</span>(<span class="variable constant_">SHEET_ID</span>).<span class="title function_">getSheetByName</span>(<span class="string">&#x27;line_ids&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> rows = sheet.<span class="title function_">getDataRange</span>().<span class="title function_">getValues</span>();</span><br><span class="line"></span><br><span class="line">  groupId = groupId || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  userId = userId || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; rows.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> row = rows[i];</span><br><span class="line">    <span class="keyword">const</span> match =</span><br><span class="line">      row[<span class="number">1</span>] === sourceType &amp;&amp;</span><br><span class="line">      row[<span class="number">2</span>] === userId &amp;&amp;</span><br><span class="line">      row[<span class="number">3</span>] === groupId;</span><br><span class="line">    <span class="keyword">if</span> (match) &#123;</span><br><span class="line">      sheet.<span class="title function_">deleteRow</span>(i + <span class="number">1</span>); <span class="comment">// Google Sheetå¾1é–‹å§‹è¨ˆï¼Œæ‰€ä»¥è¦+1</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ç”¢å“éŠ·å”®è³‡æ–™"><a class="header-anchor" href="#ç”¢å“éŠ·å”®è³‡æ–™"></a>ç”¢å“éŠ·å”®è³‡æ–™</h1>
<p>ç•¶ä½¿ç”¨è€…å‚³ä¾†ã€Œçµ±è¨ˆç”¢å“éŠ·å”®æ•¸æ“šã€è¨Šæ¯æ™‚:</p>
<ul>
<li>è®€å– products å·¥ä½œè¡¨çš„ç”¢å“éŠ·å”®è³‡æ–™</li>
<li>å°‡ç”¢å“æŒ‰ç…§åç¨±åˆ†çµ„ï¼Œä¸¦ä¸”æ¯çµ„å…§ä¾ç…§æ—¥æœŸæ’åº</li>
<li>å°‡è³‡æ–™è½‰æˆ Flex Bubble å¡ç‰‡æ ¼å¼</li>
</ul>
<h2 id="getProductData"><a class="header-anchor" href="#getProductData"></a>getProductData</h2>
<p>å¾ products å·¥ä½œè¡¨è®€å–ç”¢å“éŠ·å”®è³‡æ–™ã€‚</p>
<p>æ¯ç­†è³‡æ–™åŒ…å«:</p>
<ul>
<li>æ—¥æœŸ</li>
<li>ç”¢å“åç¨±</li>
<li>å”®åƒ¹</li>
<li>éŠ·å”®æ•¸é‡</li>
</ul>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®€å–ç”¢å“è³‡æ–™</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getProductData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(<span class="string">&#x27;products&#x27;</span>);</span><br><span class="line">  const rows = sheet.getDataRange().getValues(); <span class="comment">// è®€å–å…¨éƒ¨è³‡æ–™</span></span><br><span class="line"></span><br><span class="line">  const products = rows.<span class="built_in">slice</span>(<span class="number">1</span>).<span class="built_in">map</span>(<span class="function"><span class="params">row</span> =&gt;</span> (&#123;    <span class="comment">// è·³éç¬¬ä¸€åˆ—æ¨™é¡Œï¼Œé–‹å§‹æ•´ç†è³‡æ–™</span></span><br><span class="line">    <span class="built_in">date</span>: row[<span class="number">0</span>],               <span class="comment">// Aæ¬„ = æ—¥æœŸ</span></span><br><span class="line">    product_name: row[<span class="number">1</span>],       <span class="comment">// Bæ¬„ = ç”¢å“åç¨±</span></span><br><span class="line">    sell_price: row[<span class="number">2</span>],         <span class="comment">// Cæ¬„ = å”®åƒ¹</span></span><br><span class="line">    sell_quantity: row[<span class="number">3</span>]       <span class="comment">// Dæ¬„ = éŠ·å”®æ•¸é‡</span></span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">return</span> products; <span class="comment">// å›å‚³æ•´ç†å¥½çš„ç”¢å“è³‡æ–™é™£åˆ—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2Fproducts-data.jpg?alt=media&amp;token=e1e09ce3-4eb8-4239-9b35-cf4d94f1d2d8" alt="products-data"></p>
<h2 id="groupAndSortProducts"><a class="header-anchor" href="#groupAndSortProducts"></a>groupAndSortProducts</h2>
<p>å°‡ç”¢å“æŒ‰ç…§åç¨±åˆ†çµ„ï¼Œä¸¦ä¸”æ¯çµ„å…§ä¾ç…§æ—¥æœŸæ’åºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°‡ç”¢å“åˆ†çµ„æ’åº</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">groupAndSortProducts</span>(<span class="params">products</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> grouped = &#123;&#125;; <span class="comment">// å»ºç«‹ç©ºçš„åˆ†çµ„ç‰©ä»¶</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ†çµ„</span></span><br><span class="line">  products.<span class="title function_">forEach</span>(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!grouped[p.<span class="property">product_name</span>]) grouped[p.<span class="property">product_name</span>] = [];</span><br><span class="line">    grouped[p.<span class="property">product_name</span>].<span class="title function_">push</span>(p);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯çµ„å…§éƒ¨æ’åº(ä¾æ—¥æœŸå¾å°åˆ°å¤§)</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> name <span class="keyword">in</span> grouped) &#123;</span><br><span class="line">    grouped[name].<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Date</span>(a.<span class="property">date</span>) - <span class="keyword">new</span> <span class="title class_">Date</span>(b.<span class="property">date</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> grouped; <span class="comment">// å›å‚³åˆ†å¥½çµ„ã€æ’åºå¥½çš„è³‡æ–™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è³‡æ–™æ ¼å¼è™•ç†"><a class="header-anchor" href="#è³‡æ–™æ ¼å¼è™•ç†"></a>è³‡æ–™æ ¼å¼è™•ç†</h2>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•¸å­—åŠ ä¸Šåƒåˆ†ä½é€—è™Ÿ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatNumber</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Number</span>(num).toLocaleString(<span class="string">&#x27;en-US&#x27;</span>, &#123; <span class="attribute">minimumFractionDigits</span>: <span class="number">2</span>, <span class="attribute">maximumFractionDigits</span>: <span class="number">2</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¥æœŸæ ¼å¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatDateToYMD</span>(<span class="params">dateStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">date</span> = <span class="keyword">new</span> <span class="built_in">Date</span>(dateStr);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isNaN</span>(<span class="built_in">date</span>.getTime())) <span class="keyword">return</span> <span class="string">&#x27;æœªçŸ¥æ—¥æœŸ&#x27;</span>; <span class="comment">// æ—¥æœŸéŒ¯èª¤æ™‚å›å‚³&quot;æœªçŸ¥æ—¥æœŸ&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> year = <span class="built_in">date</span>.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> month = <span class="built_in">String</span>(<span class="built_in">date</span>.getMonth() + <span class="number">1</span>).padStart(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> day = <span class="built_in">String</span>(<span class="built_in">date</span>.getDate()).padStart(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;year&#125;</span>/<span class="subst">$&#123;month&#125;</span>/<span class="subst">$&#123;day&#125;</span>`</span>; <span class="comment">// æ ¼å¼åŒ–æˆ2025/04/28</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="createFlexBubbles"><a class="header-anchor" href="#createFlexBubbles"></a>createFlexBubbles</h2>
<p>æŠŠæ•´ç†å¥½çš„è³‡æ–™è½‰æˆä¸€å€‹ä¸€å€‹ Flex Bubble å¡ç‰‡æ ¼å¼ã€‚</p>
<ul>
<li>è³‡æ–™åŒ…å«ç”¢å“åç¨±ã€æ—¥æœŸã€å”®åƒ¹(åŠ ä¸Šåƒåˆ†ä½)ã€éŠ·å”®æ•¸é‡</li>
<li>ä¸åŒç”¢å“è¨­å®šä¸åŒèƒŒæ™¯é¡è‰²</li>
<li>å°‡ä¸åŒå¡ç‰‡å†çµ„æˆä¸€å€‹ Flex Carousel</li>
</ul>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»ºç«‹Flexè¨Šæ¯å…§å®¹</span></span><br><span class="line">function <span class="title function_">createFlexBubbles</span>(products) &#123;</span><br><span class="line">  <span class="keyword">const</span> grouped = <span class="title function_">groupAndSortProducts</span>(products); <span class="comment">// å…ˆåˆ†çµ„ã€æ’åºå¥½</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯å€‹ç”¢å“ç¾¤ç”¨ä¸åŒé¡è‰²èƒŒæ™¯</span></span><br><span class="line">  <span class="keyword">const</span> colorMap = &#123;</span><br><span class="line">    <span class="string">&#x27;Trek 820&#x27;</span>: <span class="string">&#x27;#00C853&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Ritchey&#x27;</span>: <span class="string">&#x27;#AA00FF&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Surly&#x27;</span>: <span class="string">&#x27;#2962FF&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Trek Fuel&#x27;</span>: <span class="string">&#x27;#FF6D00&#x27;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> defaultColor = <span class="string">&#x27;#888888&#x27;</span>; <span class="comment">// é è¨­é¡è‰²</span></span><br><span class="line">  <span class="keyword">const</span> bubbles = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (let productName in grouped) &#123;</span><br><span class="line">    <span class="keyword">const</span> productGroup = grouped[productName];</span><br><span class="line">    <span class="keyword">const</span> <span class="type">color</span> = colorMap[productName] || defaultColor;</span><br><span class="line"></span><br><span class="line">    productGroup.<span class="property">forEach</span>(product =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> safeProductName = (product.<span class="property">product_name</span> || <span class="string">&#x27;æœªçŸ¥ç”¢å“&#x27;</span>).<span class="property">toString</span>().<span class="property">substring</span>(<span class="number">0</span>, <span class="number">50</span>); </span><br><span class="line">      <span class="keyword">const</span> safeDate = formatDateToYMD(product.<span class="property">date</span>);</span><br><span class="line">      <span class="keyword">const</span> price = <span class="title function_">parseFloat</span>(product.<span class="property">sell_price</span>);</span><br><span class="line">      <span class="keyword">const</span> safePrice = <span class="title function_">isNaN</span>(price) ? <span class="number">0</span> : price;</span><br><span class="line">      <span class="keyword">const</span> safeQuantity = typeof product.<span class="property">sell_quantity</span> === <span class="string">&#x27;number&#x27;</span> ? product.<span class="property">sell_quantity</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> bubble = &#123;</span><br><span class="line">        type: <span class="string">&#x27;bubble&#x27;</span>,</span><br><span class="line">        <span class="built_in">size</span>: <span class="string">&#x27;micro&#x27;</span>,</span><br><span class="line">        body: &#123;</span><br><span class="line">          type: <span class="string">&#x27;box&#x27;</span>,</span><br><span class="line">          layout: <span class="string">&#x27;vertical&#x27;</span>,</span><br><span class="line">          spacing: <span class="string">&#x27;sm&#x27;</span>,</span><br><span class="line">          backgroundColor: <span class="type">color</span>,</span><br><span class="line">          paddingAll: <span class="string">&#x27;20px&#x27;</span>,</span><br><span class="line">          contents: [</span><br><span class="line">            &#123;</span><br><span class="line">              type: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">              <span class="built_in">text</span>: safeProductName,</span><br><span class="line">              weight: <span class="string">&#x27;bold&#x27;</span>,</span><br><span class="line">              <span class="built_in">size</span>: <span class="string">&#x27;md&#x27;</span>,</span><br><span class="line">              <span class="type">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">              wrap: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              type: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">              <span class="built_in">text</span>: `ğŸ“… $&#123;safeDate&#125;`,</span><br><span class="line">              <span class="built_in">size</span>: <span class="string">&#x27;sm&#x27;</span>,</span><br><span class="line">              <span class="type">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              type: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">              <span class="built_in">text</span>: `ğŸ·ï¸ $$&#123;formatNumber(safePrice)&#125;`,</span><br><span class="line">              <span class="built_in">size</span>: <span class="string">&#x27;sm&#x27;</span>,</span><br><span class="line">              <span class="type">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              type: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">              <span class="built_in">text</span>: `ğŸ“¦ éŠ·å”® $&#123;safeQuantity&#125; å°`,</span><br><span class="line">              <span class="built_in">size</span>: <span class="string">&#x27;sm&#x27;</span>,</span><br><span class="line">              <span class="type">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      bubbles.<span class="property">push</span>(bubble); <span class="comment">// æŠŠé€™å€‹å°å¡ç‰‡åŠ å…¥é™£åˆ—</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> bubbles; <span class="comment">// å›å‚³å…¨éƒ¨bubble</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ“ä½œè¨˜éŒ„"><a class="header-anchor" href="#æ“ä½œè¨˜éŒ„"></a>æ“ä½œè¨˜éŒ„</h1>
<p>å°‡æ“ä½œè¨˜éŒ„åˆ° Google Sheet çš„ logs å·¥ä½œè¡¨ä¸­ï¼Œå¹«åŠ©è¿½è¹¤bugã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ“ä½œè¨˜éŒ„</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logError</span>(<span class="params">message</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> sheet = <span class="title class_">SpreadsheetApp</span>.<span class="title function_">openById</span>(<span class="variable constant_">SHEET_ID</span>).<span class="title function_">getSheetByName</span>(<span class="string">&#x27;logs&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> timestamp = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  sheet.<span class="title function_">appendRow</span>([timestamp, message]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2Flog.jpg?alt=media&amp;token=0ac60c93-a09e-4368-a2e1-12bef24af55a" alt="log"></p>
<h1 id="ä¸»ç¨‹å¼"><a class="header-anchor" href="#ä¸»ç¨‹å¼"></a>ä¸»ç¨‹å¼</h1>
<p>é€™æ˜¯æ•´å€‹æ‡‰ç”¨çš„ä¸»å…¥å£ã€‚<br>
ç•¶ LINE Webhook é€ä¾†è¨Šæ¯æ™‚:</p>
<ul>
<li>è§£æè¨Šæ¯å…§å®¹èˆ‡ä¾†æº</li>
<li>æ ¹æ“šæ–‡å­—å…§å®¹åˆ¤æ–·è¦åŸ·è¡Œçš„å‹•ä½œ
<ul>
<li>å•Ÿç”¨å°å¹«æ‰‹</li>
<li>å–æ¶ˆå•Ÿç”¨å°å¹«æ‰‹</li>
<li>å›å‚³ç”¢å“éŠ·å”®è³‡æ–™</li>
</ul>
</li>
</ul>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»ç¨‹å¼</span></span><br><span class="line">function doPost(e) &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const contents = JSON.parse(e.postData.contents);</span><br><span class="line">    logError(<span class="string">&#x27;webhook æ”¶åˆ°ï¼š &#x27;</span> + JSON.stringify(contents));</span><br><span class="line">    Logger.<span class="keyword">log</span>(<span class="string">&#x27;webhook æ”¶åˆ°ï¼š &#x27;</span> + JSON.stringify(contents));</span><br><span class="line"></span><br><span class="line">    const events = contents.events;</span><br><span class="line">    <span class="keyword">if</span> (!events || !Array.isArray(events) || events.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> ContentService.createTextOutput(<span class="string">&#x27;NO EVENTS&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (const <span class="keyword">event</span> of events) &#123;</span><br><span class="line">      const messageText = <span class="keyword">event</span>.message?.<span class="keyword">text</span>?.<span class="keyword">trim</span>();</span><br><span class="line">      const replyToken = <span class="keyword">event</span>.replyToken;</span><br><span class="line">      const <span class="keyword">source</span> = <span class="keyword">event</span>.<span class="keyword">source</span> || &#123;&#125;;</span><br><span class="line">      const sourceType = <span class="keyword">source</span>.type;</span><br><span class="line">      const userId = <span class="keyword">source</span>.userId;</span><br><span class="line">      const groupId = <span class="keyword">source</span>.groupId;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!messageText || !replyToken) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (messageText === ACTIVATE_KEYWORD) &#123;</span><br><span class="line">        const isNew = addRecord(sourceType, groupId, userId, messageText);</span><br><span class="line">        replyTextMessage(replyToken, isNew ? <span class="string">&quot;âœ… å·²å•Ÿç”¨å°å¹«æ‰‹&quot;</span> : <span class="string">&#x27;ğŸ‰ ä½ å·²ç¶“å•Ÿç”¨éå›‰ï¼&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (messageText === DEACTIVATE_KEYWORD) &#123;</span><br><span class="line">        const removed = removeRecord(sourceType, groupId, userId);</span><br><span class="line">        replyTextMessage(replyToken, removed ? <span class="string">&quot;âŒ å·²å–æ¶ˆå•Ÿç”¨å°å¹«æ‰‹&quot;</span> : <span class="string">&#x27;âš ï¸ å°šæœªå•Ÿç”¨ï¼Œç„¡éœ€å–æ¶ˆã€‚&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (messageText === PRODUCTS_KEYWORD) &#123;</span><br><span class="line">        const products = getProductData();</span><br><span class="line">        const bubbles = createFlexBubbles(products.slice(<span class="number">0</span>, <span class="number">12</span>));</span><br><span class="line">        <span class="keyword">if</span> (bubbles.length === <span class="number">0</span>) &#123;</span><br><span class="line">          replyTextMessage(replyToken, <span class="string">&#x27;âš ï¸ ç›®å‰æ²’æœ‰ç”¢å“éŠ·å”®æ•¸æ“šå–”ï¼&#x27;</span>);</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        const flexContents = &#123;</span><br><span class="line">          type: <span class="string">&#x27;carousel&#x27;</span>,</span><br><span class="line">          contents: bubbles</span><br><span class="line">        &#125;;</span><br><span class="line">        replyFlexMessage(replyToken, flexContents, <span class="string">&#x27;çµ±è¨ˆç”¢å“éŠ·å”®æ•¸æ“š&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ContentService.createTextOutput(<span class="string">&#x27;OK&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (<span class="keyword">error</span>) &#123;</span><br><span class="line">    Logger.<span class="keyword">log</span>(<span class="string">&#x27;éŒ¯èª¤è¨Šæ¯: &#x27;</span> + <span class="keyword">error</span>);</span><br><span class="line">    logError(<span class="string">&#x27;éŒ¯èª¤è¨Šæ¯: &#x27;</span> + <span class="keyword">error</span>);</span><br><span class="line">    <span class="keyword">return</span> ContentService.createTextOutput(<span class="string">&#x27;éŒ¯èª¤: &#x27;</span> + <span class="keyword">error</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="éƒ¨ç½²"><a class="header-anchor" href="#éƒ¨ç½²"></a>éƒ¨ç½²</h1>
<ol>
<li>é»é¸ã€ŒDeployã€ &gt; ã€ŒNew deploymentã€
<ul>
<li>é¡å‹: ç¶²è·¯æ‡‰ç”¨ç¨‹å¼</li>
<li>èªªæ˜: å¡«å¯«æœ¬æ¬¡éƒ¨ç½²çš„èªªæ˜</li>
<li>åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼çš„èº«ä»½: è‡ªå·±</li>
<li>èª°å¯ä»¥å­˜å–: ä»»ä½•äºº</li>
</ul>
</li>
<li>æˆåŠŸéƒ¨ç½²å¾Œæœƒå‡ºç¾ä¸€å€‹ç¶²å€</li>
<li>å‰å¾€ <a target="_blank" rel="noopener" href="https://developers.line.biz/console/">LINE Developers</a></li>
<li>é¸æ“‡ä¸€å€‹ LINE å®˜æ–¹å¸³è™Ÿ</li>
<li>é€²å…¥ã€ŒMessaging APIã€è¨­å®šé </li>
<li>æ‰¾åˆ°ã€ŒWebhook URLã€æ¬„ä½ï¼Œè²¼ä¸Šéƒ¨ç½²å¾Œ<code>https://script.google.com/.../exec</code>ç¶²å€</li>
<li>ä¹‹å¾Œæœ‰æ›´æ–°ï¼Œå¯ä»¥é»æ“Šã€ŒManage deploymentsã€ï¼Œæ–°å¢ä¸€å€‹æ–°ç‰ˆæœ¬çš„éƒ¨ç½²</li>
</ol>
<h1 id="å…è²»é…é¡å’Œé™åˆ¶"><a class="header-anchor" href="#å…è²»é…é¡å’Œé™åˆ¶"></a>å…è²»é…é¡å’Œé™åˆ¶</h1>
<p>é›–ç„¶ Google Apps Script (GAS) æä¾›äº†å…è²»é¡åº¦ï¼Œä½†åœ¨é–‹ç™¼å’Œéƒ¨ç½² LINE Bot æ™‚ï¼Œé‚„æ˜¯æœ‰ä¸€äº›éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„é…é¡å’Œä½¿ç”¨é™åˆ¶ï¼Œé¿å…å› ç‚ºè¶…å‡ºé™åˆ¶å°è‡´æœå‹™ä¸­æ–·ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">åŠŸèƒ½</th>
<th style="text-align:left">æ¶ˆè²»è€…å¸³æˆ¶(å¦‚<code>gmail.com</code>)</th>
<th style="text-align:left">Google Workspaceå¸³æˆ¶</th>
<th style="text-align:left">æ³¨æ„äº‹é …</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">â³ <strong>è§¸ç™¼æ¢ä»¶ç¸½åŸ·è¡Œéšæ®µ</strong><br>(Triggers total runtime)</td>
<td style="text-align:left">90åˆ†é˜/å¤©</td>
<td style="text-align:left">æ¯å¤©6å°æ™‚</td>
<td style="text-align:left">æ¯å¤©åŸ·è¡Œçš„ç¸½æ™‚é•·ä¸Šé™ï¼Œè¶…éå¾Œç•¶å¤©å°‡ç„¡æ³•å†è§¸ç™¼è…³æœ¬</td>
</tr>
<tr>
<td style="text-align:left">ğŸ“ˆ <strong>ç¶²å€æ“·å–å‘¼å«æ¬¡æ•¸</strong><br>(URL Fetch calls)</td>
<td style="text-align:left">20,000æ¬¡/å¤©</td>
<td style="text-align:left">100,000æ¬¡/å¤©</td>
<td style="text-align:left">æ¯æ¬¡ä½¿ç”¨<code>UrlFetchApp.fetch()</code>å‘¼å« LINE API éƒ½æœƒæ¶ˆè€—ï¼Œä¾‹å¦‚ç™¼é€æ–‡å­—<code>replyTextMessage</code>ã€ç™¼é€Flexè¨Šæ¯<code>replyFlexMessage</code>ç­‰</td>
</tr>
<tr>
<td style="text-align:left">â±ï¸ <strong>æŒ‡ä»¤ç¢¼åŸ·è¡Œæ™‚é–“</strong><br>(Script runtime)</td>
<td style="text-align:left">6åˆ†é˜/æ¬¡</td>
<td style="text-align:left">6åˆ†é˜/æ¬¡</td>
<td style="text-align:left">æ¯æ¬¡è…³æœ¬åŸ·è¡Œï¼Œä¸è«–æ˜¯ä¾†è‡ªWebhookæˆ–è§¸ç™¼å™¨ï¼Œéƒ½å¿…é ˆåœ¨6åˆ†é˜å…§çµæŸï¼Œå¦å‰‡æœƒè‡ªå‹•ä¸­æ–·</td>
</tr>
</tbody>
</table>
<p>å®Œæ•´é…é¡å’Œé™åˆ¶è¡¨è«‹çœ‹ <a target="_blank" rel="noopener" href="https://developers.google.com/apps-script/guides/services/quotas?hl=zh-tw">Apps Script Quotas å®˜æ–¹æ–‡ä»¶</a>ã€‚</p>
<h1 id="é…é¡ä¼°ç®—å°å·¥å…·"><a class="header-anchor" href="#é…é¡ä¼°ç®—å°å·¥å…·"></a>é…é¡ä¼°ç®—å°å·¥å…·</h1>
<p>æˆ‘å¯«äº†ä¸€å€‹é…é¡ä¼°ç®—å°å·¥å…·ï¼Œå¯ä»¥å”åŠ©ä½ ä¼°ç®—å¯èƒ½æœƒæ¶ˆè€—çš„ã€Œè§¸ç™¼æ¢ä»¶ç¸½åŸ·è¡Œéšæ®µ(Triggers total runtime)ã€å’Œã€Œç¶²å€æ“·å–å‘¼å«æ¬¡æ•¸(URL Fetch calls)ã€ä½¿ç”¨é‡ã€‚</p>
<h2 id="è§¸ç™¼æ¢ä»¶ç¸½åŸ·è¡Œéšæ®µ"><a class="header-anchor" href="#è§¸ç™¼æ¢ä»¶ç¸½åŸ·è¡Œéšæ®µ"></a>è§¸ç™¼æ¢ä»¶ç¸½åŸ·è¡Œéšæ®µ</h2>
<p>ä¼°ç®—æ¯å¤©çš„ç¸½åŸ·è¡Œæ™‚é–“ã€‚</p>
<h3 id="è§¸ç™¼å™¨æ¯æ¬¡åŸ·è¡Œæ™‚é–“"><a class="header-anchor" href="#è§¸ç™¼å™¨æ¯æ¬¡åŸ·è¡Œæ™‚é–“"></a>è§¸ç™¼å™¨æ¯æ¬¡åŸ·è¡Œæ™‚é–“</h3>
<p>å¯ä»¥é€²å…¥è§¸ç™¼å™¨çš„åŸ·è¡Œé …ç›®ä¸­æŸ¥çœ‹è§¸ç™¼å™¨æ¯æ¬¡åŸ·è¡Œçš„æ™‚é–“ã€‚<br>
<img src="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2Ftriggers-total-runtime.jpg?alt=media&amp;token=536d6319-c86e-416b-af0a-f305236fa1e5" alt="triggers-total-runtime"></p>
<h3 id="è§¸ç™¼å™¨é–“éš”æ™‚é–“"><a class="header-anchor" href="#è§¸ç™¼å™¨é–“éš”æ™‚é–“"></a>è§¸ç™¼å™¨é–“éš”æ™‚é–“</h3>
<p>å¯ä»¥é€²å…¥è§¸ç™¼å™¨çš„è¨­å®šä¸­æŸ¥çœ‹è§¸ç™¼å™¨æ‰€è¨­å®šçš„é–“éš”æ™‚é–“ã€‚<br>
<img src="https://firebasestorage.googleapis.com/v0/b/stellacoding1111.appspot.com/o/article%2Fapps-script-line-bot-products%2Furl-fetch-calls.jpg?alt=media&amp;token=78b5a0da-26d5-40b0-9f4e-ec7ed130506b" alt="url-fetch-calls"></p>
<h2 id="ç¶²å€æ“·å–å‘¼å«æ¬¡æ•¸"><a class="header-anchor" href="#ç¶²å€æ“·å–å‘¼å«æ¬¡æ•¸"></a>ç¶²å€æ“·å–å‘¼å«æ¬¡æ•¸</h2>
<p>ä¼°ç®—æ¯å¤©çš„ç¶²å€æ“·å–å‘¼å«æ¬¡æ•¸ã€‚</p>
<p>ä»¥æœ¬ç¯‡æ–‡ç« çš„ç¨‹å¼ç¢¼ç‚ºä¾‹:</p>
<ul>
<li>æ¯æ¬¡ä½¿ç”¨è€…å•Ÿç”¨å°å¹«æ‰‹ â†’ å‘¼å« LINE API 1 æ¬¡</li>
<li>æ¯æ¬¡æŸ¥è©¢ç”¢å“éŠ·å”®è³‡æ–™ â†’ å‘¼å« LINE API 1 æ¬¡</li>
<li>è‹¥æ¯å¤©æœ‰ 100 ä½ä½¿ç”¨è€…ï¼Œå¹³å‡æ¯äººäº’å‹• 2 æ¬¡</li>
<li>â†’ å‰‡æ¯å¤©æœƒæ¶ˆè€— 100 Ã— 2 = 200 æ¬¡å‘¼å«</li>
</ul>
<h2 id="é…é¡ä¼°ç®—å°å·¥å…·-v2"><a class="header-anchor" href="#é…é¡ä¼°ç®—å°å·¥å…·-v2"></a>é…é¡ä¼°ç®—å°å·¥å…·</h2>

<!-- ç¶²å€æ“·å–å‘¼å«æ¬¡æ•¸ å’Œ è§¸ç™¼æ¢ä»¶ç¸½åŸ·è¡Œéšæ®µ è¨ˆç®—å°å·¥å…· -->
<style>
.tabs-wrapper {
  margin-top: 20px;
  border: 1px solid #ddd;
  border-radius: 10px;
  background: #f9f9f9;
  font-family: "Segoe UI", Arial, sans-serif;
}
.tab-buttons {
  display: flex;
  border-bottom: 1px solid #ddd;
}
.tab-buttons button {
  flex: 1;
  padding: 12px;
  background: none;
  border: none;
  cursor: pointer;
  font-weight: bold;
  font-size: 16px;
  border-bottom: 3px solid transparent;
}
.tab-buttons button.active {
  border-color: #007bff;
  color: #007bff;
  background: #ffffff;
}
.tab-content {
  display: none;
  padding: 20px;
}
.tab-content.active {
  display: block;
}
.calc-card label {
  display: block;
  margin: 10px 0 6px;
  font-weight: bold;
}
.calc-card input {
  max-width: 200px;
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 6px;
}
.calc-card button {
  margin-top: 10px;
  padding: 8px 16px;
  background: #007bff;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
.calc-card button:hover {
  background: #0056b3;
}
.calc-result {
  display: none;
  margin-top: 16px;
  background: #eef6ff;
  padding: 14px 18px;
  border-radius: 8px;
  font-size: 15px;
  line-height: 1.8;
}
</style>

<div class="tabs-wrapper">
  <div class="tab-buttons">
    <button class="active" onclick="switchTab('tab-trigger')">â³ Triggers total runtime</button>
    <button onclick="switchTab('tab-fetch')">ğŸ“ˆ URL Fetch calls</button>
  </div>

  <div id="tab-fetch" class="tab-content calc-card">
    <label for="urlfetch_interactions">æ¯å¤©äº’å‹•æ¬¡æ•¸ï¼š</label>
    <p>å¦‚: å‡è¨­æ¯æ¬¡åŸ·è¡Œæ™‚æœƒå‘¼å«1æ¬¡LINE APIï¼Œæ¯å¤©æœ‰200å€‹ä½¿ç”¨è€…ï¼Œå¹³å‡æ¯ä½äº’å‹•2æ¬¡ï¼Œè«‹è¼¸å…¥200ã€‚</p>
    <input id="urlfetch_interactions" type="number" placeholder="ä¾‹å¦‚ 200" value="200">
    <button onclick="calculateUrlFetch()">è¨ˆç®—</button>
    <div id="urlfetch_result" class="calc-result"></div>
  </div>

  <div id="tab-trigger" class="tab-content active calc-card">
    <label for="trigger_duration">æ¯æ¬¡è§¸ç™¼åŸ·è¡Œæ™‚é–“ï¼ˆç§’ï¼‰ï¼š</label>
    <p>å¦‚: è§¸ç™¼å™¨æ¯æ¬¡åŸ·è¡Œçš„æ™‚é–“ï¼Œå‡è¨­è§¸ç™¼å™¨æ¯æ¬¡åŸ·è¡Œéœ€è¦15.379ç§’ï¼Œè«‹è¼¸å…¥15.379ã€‚</p>
    <input id="trigger_duration" type="number" placeholder="ä¾‹å¦‚ 15.379" value="15.379">

    <label for="trigger_interval">è§¸ç™¼é–“éš”ï¼ˆåˆ†é˜ï¼‰ï¼š</label>
    <p>å¦‚: è§¸ç™¼å™¨æ¯æ¬¡åŸ·è¡Œçš„é–“éš”æ™‚é–“ï¼Œå‡è¨­è¨­å®šæ¯10åˆ†é˜è¦å•Ÿå‹•è§¸ç™¼å™¨ï¼Œè«‹è¼¸å…¥10ã€‚</p>
    <input id="trigger_interval" type="number" placeholder="ä¾‹å¦‚ 10" value="10">

    <button onclick="calculateTrigger()">è¨ˆç®—</button>
    <div id="trigger_result" class="calc-result"></div>
  </div>
</div>

<script>
function switchTab(tabId) {
  const tabs = document.querySelectorAll('.tab-content');
  const buttons = document.querySelectorAll('.tab-buttons button');

  tabs.forEach(t => t.classList.remove('active'));
  buttons.forEach(b => b.classList.remove('active'));

  document.getElementById(tabId).classList.add('active');
  event.target.classList.add('active');
}

function calculateUrlFetch() {
  const value = parseInt(document.getElementById('urlfetch_interactions').value);
  const result = document.getElementById('urlfetch_result');
  if (isNaN(value) || value <= 0) {
    result.innerHTML = 'âš ï¸ è«‹è¼¸å…¥æœ‰æ•ˆçš„äº’å‹•æ¬¡æ•¸ï¼';
    result.style.display = 'block';
    return;
  }
  const percent = ((value / 20000) * 100).toFixed(2);
  result.innerHTML = `
    âœ… æ¯å¤©é ä¼°æ¶ˆè€— <strong>${value}</strong> æ¬¡ç¶²å€æ“·å–å‘¼å«ã€‚<br>
    ğŸ“Š ä½¿ç”¨ç‡ç‚º <strong>${percent}%</strong>ï¼ˆä»¥å…è²»å¸³æˆ¶ä¸Šé™è¨ˆç®—ï¼‰ã€‚<br><br>
    ğŸ”º <strong>å…è²»å¸³æˆ¶ä¸Šé™ï¼š</strong>20,000 æ¬¡/å¤©<br>
    ğŸ”º <strong>Workspaceå¸³æˆ¶ä¸Šé™ï¼š</strong>100,000 æ¬¡/å¤©
  `;
  result.style.display = 'block';
}

function calculateTrigger() {
  const seconds = parseFloat(document.getElementById('trigger_duration').value);
  const interval = parseFloat(document.getElementById('trigger_interval').value);
  const result = document.getElementById('trigger_result');

  if (isNaN(seconds) || isNaN(interval) || seconds <= 0 || interval <= 0) {
    result.innerHTML = 'âš ï¸ è«‹è¼¸å…¥æœ‰æ•ˆçš„ç§’æ•¸èˆ‡é–“éš”ï¼';
    result.style.display = 'block';
    return;
  }

  const perDay = 1440 / interval;
  const totalSeconds = perDay * seconds;
  const totalMinutes = (totalSeconds / 60).toFixed(2);
  const usagePercent = ((totalMinutes / 90) * 100).toFixed(2);  // 90 æ˜¯å…è²»å¸³æˆ¶ä¸Šé™

  result.innerHTML = `
    âœ… æ¯å¤©æœƒè§¸ç™¼ <strong>${perDay.toFixed(0)}</strong> æ¬¡ã€‚<br>
    â±ï¸ æ¯å¤©ç¸½åŸ·è¡Œæ™‚é–“ç‚º <strong>${totalMinutes}</strong> åˆ†é˜ã€‚<br>
    ğŸ“Š ä½¿ç”¨ç‡ç‚º <strong>${usagePercent}%</strong>ï¼ˆä»¥å…è²»å¸³æˆ¶ä¸Šé™è¨ˆç®—ï¼‰ã€‚<br><br>
    ğŸ”º <strong>å…è²»å¸³æˆ¶ä¸Šé™ï¼š</strong>90 åˆ†é˜/å¤©<br>
    ğŸ”º <strong>Workspaceå¸³æˆ¶ä¸Šé™ï¼š</strong>360 åˆ†é˜/å¤©
  `;
  result.style.display = 'block';
}
</script>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/Apps-Script/" rel="tag"># Apps Script</a>
              <a href="/blog/tags/LINE-Bot/" rel="tag"># LINE Bot</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/llm-api-free-resources/" rel="prev" title="ã€LLM APIã€‘ç”³è«‹å…è²» API ä½¿ç”¨é¡åº¦">
                  <i class="fa fa-angle-left"></i> ã€LLM APIã€‘ç”³è«‹å…è²» API ä½¿ç”¨é¡åº¦
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/leetcode-sql-197-rising-temperature/" rel="next" title="ã€SQLã€‘æ¯”ã€Œæ˜¨å¤©ã€æº«åº¦é‚„é«˜çš„ç´€éŒ„">
                  ã€SQLã€‘æ¯”ã€Œæ˜¨å¤©ã€æº«åº¦é‚„é«˜çš„ç´€éŒ„ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">å²æˆ´æ‹‰å¯«æ‰£</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/sidebar.js"></script><script src="/blog/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script>
  <script src="/blog/js/third-party/tags/mermaid.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/blog/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"estellacoding","repo":"blog","client_id":"Ov23liBnWPuObZGktbAv","client_secret":"9ed6e261cd75af620744058daafa56b80a53ffa8","admin_user":"estellacoding","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"labels":"gitalk","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"9bb03e1f492d6b0ea2942d528e67120d"}</script>
<script src="/blog/js/third-party/comments/gitalk.js"></script>

</body>
</html>
